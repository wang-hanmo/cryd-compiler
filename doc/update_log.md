## 文档列举了一部分更新

## 2022年4月21日
目前实现了语法分析器的基本功能，生成较为完整的AST结构  
主要改动有：  
1、完成parse.y中大多数文法规则和语义动作的对应(可完成测例test_compunit.in)  
2、添加了FuncCall、FuncFParam等新的ASTType使AST完整  
3、词法分析中将标识符以std::string的方式存储并交给语法分析器  
4、增加了set_value_type()函数以改变ASTNode的m_value_type(适用于VarDecl、ConstDecl等情况)  
仍然存在以下问题：  
1、没有对是否二义性进行检查(如if-else if else)  
2、运算的结合性和优先级没有充分验证  
3、对AST中m_is_lvalue的赋值是随便写的，因为什么时候赋lvalue还不太清楚  
4、尚未实现对于数组的支持，包括数组的声明、初始化、引用等  
5、没有完成隐式类型转换结点，没有Dereference(解引用*)  
6、可能存在其他构造AST的错误  

## 2022年5月8日

作者：乔袁飞龙

实现了线性IR（三地址码）的生成

已知问题：

1、没有处理和数组有关的语句，待进一步商议后决定。

2、没有处理局部变量初值赋予语句，需要等语义分析完成后才能实现。

3、AST中缺少隐式类型转换节点，导致变量作为右值时不正确，正确实现语义分析即可解决。

4、AST中数组长度分析不正确

待优化点：
1、if语句的条件计算完成后需要先赋予一个临时变量再做判断，没有用到设计的bin_if类型的语句

疑问点：
1、是否应该区分逻辑(i1)类型和i32类型？

2、是否应该把临时变量抽象成一个类


## 2022年5月12日 

作者：乔袁飞龙

对三地址码功能进行了修改和扩展，实现进行了大幅修改，修复了已知问题。

已知问题：

暂无

疑问点：

1、是否应该区分逻辑(i1)类型和i32类型？
    是

2、是否应该把临时变量抽象成一个类？
    暂未解决

 
## 2022年5月18日 第一次

作者：乔袁飞龙

1、实现了线性IR转到控制流图

2、修复了IR生成的一些bug

3、实现了控制流图转回C语言的功能，以便测试前端正确性

4、添加了语义分析输出行号功能

5、将测试程序改为c后缀

6、撰写了IR设计的简单文档

已知问题：

没有处理库函数

## 2022年5月18日 第二次

作者：乔袁飞龙

1、合并冲突

已知问题：

没有处理库函数

常量折叠有bug

## 2022年5月18日 第三次

作者：乔袁飞龙

1、优化文件目录结构

已知问题：

同上

## 2022年5月22日

作者：乔袁飞龙

1、加入库函数支持，IR反转成的C程序可以编译运行了

2、修复IR、CFG生成的bug

3、注释掉了在AST中删除初始化节点的代码，它们会导致定义的接口不一致，转IR程序无法工作。另外这些代码存在内存泄漏问题。

4、语义分析中加入隐式类型转换节点

5、格式化了一些源文件

已知问题：
1、数组使用变量初始化的情况考虑不足，需要重新设计初始化器

## 2022年5月23日

作者：乔袁飞龙

1、工作同步

2、在CFG中维护反向边，增加判断入口和出口节点,以及删除边的函数

3、实现了空基本块消除优化

已知问题：

同上

## 2022年5月23日 第二次

作者：乔袁飞龙

1、修复缺少头文件，一些平台无法编译的bug

2、修复IR中引用函数参数时，编号向后偏移1的bug

3、修复IR中调用函数的返回值被丢弃的bug

4、修复IR中引用数组元素进行地址计算时类型错误的bug

已知问题：

同上

## 2022年5月25日

作者：乔袁飞龙

1、IR中Load和Store指令分别改为ArrayLoad和ArrayStore,支持偏移量

2、IR中RParam指令支持多种类型操作数

3、支持数组使用变量初始化

4、修复bug，IR编译后通过前50个测试点


已知问题：

测试点仍有许多未通过

## 2022年5月25日 第二次

作者：乔袁飞龙

1、改善IR生成、IR转控制流图的代码质量

已知问题：

测试点仍有许多未通过

## 2022年5月27日

作者：乔袁飞龙

1、修复有关IR生成、语义分析的许多bug

2、IR中增加一种addr类型，表示一个地址，用于传递数组参数

已知问题：

测试点现在仅剩第86、95个不能通过

## 2022年5月29日

作者：乔袁飞龙

1、通过内联汇编的方式开大栈，通过第86个测试点

已知问题：

测试点现在仅剩第95个不能通过


## 2022年6月1日

作者：乔袁飞龙

1、修改IR数据结构设计

2、实现IR符号表

3、修复IR操作数类型信息缺失的bug

4、修复AST上条件节点结果的值类型为浮点数的bug

已知问题：

正在调第95个测试点，依然未通过

## 2022年6月1日 第二次

作者：乔袁飞龙

1、修复IR转C的bug，前端测试全部通过

2、减少IR生成时InstrList的拷贝次数，提高编译效率

## 2022年6月6日

作者：乔袁飞龙

1、完成控制流图到SSA形式的转换，包含独立的支配树计算模块，可以在其他算法中复用。

2、实现集合快速求交并的BitMap数据结构

## 2022年6月8日

作者：乔袁飞龙

1、修复SSA和常量折叠的bug

## 2022年6月8日 第二次

作者：乔袁飞龙

1、代数化简优化（不包含强度削弱）

2、IR定义修改,ValReturn和BlockCondGoto指令支持立即数

## 2022年6月9日

作者：王翰墨

1、修改reg_alloc结构,提供RAT类的寄存器分配接口RAT::reg_alloc(IRSymbol* symbol)

## 2022年6月10日

作者：王翰墨

1、修改RIG和RAT类结构，加入存放变量活跃区间的数据结构

2、修改活跃区间边界判断（定值闭、操作数开）

3、提供指定IR符号和寄存器在当前IR行是否活跃的检测

## 2022年6月12日

作者：王玉佳

1、通过扫描CFG生成ARM汇编，float和全局变量访问还未实现，其余还有一些bug待修复。

## 2022年6月27日

作者：王翰墨

1、修改Liveness中对IRBlock和IRSymbol的组织方式，用m_tag索引，用set维护visited

2、修改main.cpp中的参数解析，用clipp.h将命令格式与大赛要求统一

## 2022年6月27日

作者：王玉佳

1、增加全局变量访问，修复bug。


## 2022年7月3日

作者：乔袁飞龙

1、修复SSA的bug

2、SSA转回原形式

3、IR定义的修改(区分Param类型和Local类型)

4、实现了稀疏条件常量传播，通过99个测试点，第82个仍有问题。

5、修改测试脚本

6、修改参数解析

## 2022年7月3日 第二次

作者：乔袁飞龙

1、修复稀疏条件常量传播的bug，已经通过所有测试点

2、主文档的书写

3、工作同步


## 2022年7月6日

作者：乔袁飞龙

1、实现死代码删除的部分内容（死块删除）

2、IR定义文档的修改

3、工作同步

4、将优化“空基本块删除”改名为更强的“基本块化简”，但内容暂时没变

## 2022年7月6日第二次

作者：乔袁飞龙

1、实现优化“基本块化简”，通过了所有前端测试点

## 2022年7月7日

作者：乔袁飞龙

1、增强稀疏条件常量传播（考虑phi函数参数是否活跃），优化效果更好，但代价是提升了复杂度。

2、在稀疏条件常量传播中删除非活跃的phi函数参数，为死代码删除做准备。

## 2022年7月9日

作者：乔袁飞龙

1、完成并调试通过死代码删除优化，通过所有前端测试点

2、修复转SSA、稀疏条件常量传播中对数组做了无用分析，以及把数组错误看做SSA变量的问题。

3、削弱转SSA优化的依赖条件，现在不要求变量index的连续性了。

4、更正设计文档

bug发现：

1、寄存器分配疑似存在bug，函数没有参数的情况下会崩溃，暂时按照自己的理解进行了修复

## 2022年7月11日

作者：乔袁飞龙

1、修复局部公共子表达式删除的bug,通过所有前端测试点

实验思路记录：

1、学习了部分冗余删除算法，发现和IR定义产生冲突（会让t变量赋值多次，破坏其静态单赋值性），无法做这个优化。

2、计划做局部公共子表达式删除+局部复写传播+

3、与王玉佳、王翰墨一起调试汇编。学习使用gdb调试。发现疑似栈溢出的错误，以及寄存器分配线性扫描算法存在bug

## 2022年7月12日

作者：乔袁飞龙

1、完成局部复写传播，通过所有测试点

## 2022年7月15日

作者：乔袁飞龙

1、解决86测试点前端爆栈问题

作者：王玉佳

1、将汇编存入数据结构

## 2022年7月20日

作者：王玉佳

1、进行两次扫描，第一次确定需要存入内存的变量和用到的寄存器；第一次扫描结束后为需要存入内存的变量分配空间并且
确定函数开头需要保存的寄存器
1、将汇编存入数据结构

## 2022年7月21日

作者：乔袁飞龙

1、循环不变式外提(保守版)完成，通过前端所有功能测试点

2、前端加入性能测试点，发现了一些新的bug待修改

3、实现了不可达基本块删除

4、修复生成IR时局部数组初值为0时类型错误的bug

5、修复过程集成优化iter越界的bug

## 2022年7月22日

作者：乔袁飞龙

1、修复复写传播的算法错误

2、修改IR定义文档，取消符号编号相关的一些限制

3、支持数组与偏移量之间的加法操作

4、修复输出cfg时用错IO流的bug

## 2022年7月24日

作者：乔袁飞龙

1、修复AST上数组+偏移量型节点的类型问题

2、输出格式优化以及栈空间展开尝试

3、关闭优化器的调试信息输出

## 2022年7月25日

作者：乔袁飞龙

1、修复AST比较节点如果都为float类型，则本节点类型错误的bug

2、实现了一条指令可以完成的乘法强度削弱

## 2022年7月26日

作者：乔袁飞龙

1、运算类型IR指令区分处理数据类型

2、公共子表达式传播支持含全局变量的公共子表达式

3、防止类名冲突，给部分优化加上了命名空间

## 2022年7月27日

作者：乔袁飞龙

1、模展开优化

2、代数化简增强，考虑了之前漏掉的情况

## 2022年7月28日

作者：乔袁飞龙

1、死调用删除优化，通过所有前端测试点

2、更新readme

## 2022年7月29日

作者：乔袁飞龙

1、向前替代优化第一版完成，可以做赋值指令和条件指令的替代，但未经过充分测试

## 2022年7月30日

作者：乔袁飞龙

1、主要是bug修复工作
## 2022年7月31日

作者：乔袁飞龙

1、乘累加优化完成

## 2022年8月1日

作者：乔袁飞龙

1、修复乘累加优化的bug

2、强度削弱支持除以2的n次方

3、死返回值删除（过程特殊化）优化

## 2022年8月3日
作者：乔袁飞龙

1、工作同步

2、优化顺序调整

3、命名规范化

## 2022年8月4日

作者：乔袁飞龙

1、全局变量的过程间数据流分析

2、局部复写传播的全局变量支持

3、死代码删除的全局变量支持（基本块内）

## 2022年8月5日

作者：乔袁飞龙

1、使用更优的方法来实现数组初始化

## 2022年8月7日

作者：乔袁飞龙

1、AST上的循环倒置优化，通过前端所有测试点

2、循环不变式外提增强，现在能外提赋值语句了，为下一步考虑全局变量和函数做铺垫。

3、AST新增do-while节点，以及转IR的逻辑（没有新增语义分析的逻辑，因为引入do-while节点的优化是在语义分析后做的）

4、编译器性能优化，减少不必要的结构体和容器复制

5、合并冲突

6、针对新指令的适应性调整

暴露出新的bug：

1、LIR生成时对begin iterator做减法

2、循环展开展开了本应无法展开的循环，以及没有支持倒置后出现的单块循环的展开。

## 2022年8月9日

作者：乔袁飞龙

1、完成全局变量局部化优化。

## 2022年8月10日

作者：乔袁飞龙

1、增强重结合，支持乘加结合和乘除相消

2、修复向前替代和数组访问优化中出现的新bug

## 2022年8月11日

作者：乔袁飞龙

1、局部公共子表达式提取改为局部值编号的手段实现，得到了增强

2、修复指令融合中的bug

3、修复基本块化简优化的bug

4、发现了测例中一个未定义行为

5、实现标记基本块所在循环深度的函数

## 2022年8月13日

作者：乔袁飞龙

1、实现基于全局值编号的全局公共子表达式提取，通过前端测试

## 2022年8月14日

作者：乔袁飞龙

1、修复没有跑不可达块删除导致寻找自然循环的bug

2、修复迭代器越界的bug

3、减少不必要的复制，使用右值引用

